/*! tabulous - v0.1.1 - 2013-06-23
* https://github.com/drewlee/tabulous
* Copyright (c) 2013 Andrew A. Lee; Licensed MIT */
(function(t){"use strict";var e={tabCSS:"tabu-tab-active",contentCSS:"tabu-cont-active",event:"click",index:0,callback:function(){}},i={NAMESPACE:"tabulous",METHODS:["add","get","remove","set","updateDOM"],ARIA:{ROLE:"role",TAB:"tab",TABPANEL:"tabpanel",PRES:"presentation",HIDDEN:"aria-hidden",SELECTED:"aria-selected",CONTROLS:"aria-controls",LABELLEDBY:"aria-labelledby"}},a=function(){this.init.apply(this,arguments)};t.extend(a.prototype,{init:function(i,a){var n=!1;this.$el=i,this.config=t.extend({},e,a||{}),this._active=-1,this._reindex(),n="click"===this.config.event||"mouseover"===this.config.event,this.config.event=n?this.config.event:"click",this._addEvents(),this.$el.attr("role","tablist"),this.set(this.config.index)},_generateID:function(){for(var t=i.NAMESPACE+"_",e="0123456789",a=e.length,n=10,c="";n--;)c+=e.charAt(Math.floor(Math.random()*a));return t+=c},_addAriaTab:function(t,e){var a=i.ARIA,n={};t.attr(a.ROLE)!==a.PRES&&t.attr(a.ROLE,a.PRES),e.attr(a.ROLE)!==a.TAB&&(n[a.ROLE]=a.TAB),e.attr(a.SELECTED)!==!1&&(n[a.SELECTED]=!1),e.attr(a.CONTROLS)===void 0&&(n[a.CONTROLS]=e.prop("hash").substr(1)),e.attr("id")===void 0&&(n.id=this._generateID()),e.attr(n)},_addAriaContent:function(t,e){var a=i.ARIA,n={};e.attr(a.HIDDEN)!==!0&&(n[a.HIDDEN]=!0),e.attr(a.ROLE)!==a.TABPANEL&&(n[a.ROLE]=a.TABPANEL),e.attr(a.LABELLEDBY)===void 0&&(n[a.LABELLEDBY]=t.attr("id")),e.attr(n)},_addAria:function(t,e,i){this._addAriaTab(t,e),this._addAriaContent(e,i)},_reindex:function(){var e,i,a;this.cache=[],this.$el.find("li").each(t.proxy(function(n,c){e=t(c),i=e.find("a"),a=t(i.prop("hash")),this._addAria(e,i,a),this.cache.push({tab:e,content:a})},this))},_addEvents:function(){this.$el.on(this.config.event+"."+i.NAMESPACE,"a",t.proxy(function(e){var i=t(e.target),a=i.parent().index();this.set(a,e)},this))},_switchTab:function(e){var i=t(e.target.parentNode),a=i.index();this.set(a,e)},_setState:function(t,e){var a=!0,n=!1;"add"!==e&&(e="remove",a=!1,n=!0),this.cache[t]&&(this.cache[t].tab[e+"Class"](this.config.tabCSS).find("a").attr(i.ARIA.SELECTED,a),this.cache[t].content[e+"Class"](this.config.contentCSS).attr(i.ARIA.HIDDEN,n))},_reset:function(){this._setState(this._active),this._active=-1},set:function(t,e){var i=this.get();return t===i?(e&&e.preventDefault(),void 0):(("function"!=typeof this.config.callback||this.config.callback(t,this.cache[t].tab,this.cache[t].content)!==!1)&&(e&&e.preventDefault(),i>-1&&this._setState(i),this._setState(t,"add"),this._active=t),void 0)},get:function(){return this._active},updateDOM:function(t,e){this.get(),"function"==typeof t&&t(),e!==void 0?(this._reset(),this._reindex(),this.set(e)):this._reindex()},add:function(e,i,a){var n=this.cache.length,c=this.get(),s=t(e),h=t(i);a>n||(this._reset(),c>=a&&c++,a===n?(this.cache[a-1].tab.after(s),this.cache[a-1].content.after(h),this.cache.push({tab:s,content:h})):n>a&&(this.cache[a].tab.before(s),this.cache[a].content.before(h),this.cache.splice(a,0,{tab:s,content:h})),this._addAria(s,s.find("a"),h),this.set(c))},remove:function(t){var e=this.get();this.cache[t]&&(this.cache[t].tab.remove(),this.cache[t].content.remove(),t===this._active&&(this._reset(),!this.cache[t+1]&&this.cache[t-1]&&e--),this._reindex(),this.cache.length&&this.set(e))}}),t.fn.tabulous=function(){var e,n,c,s=[].slice.call(arguments);return"string"==typeof s[0]?this.each(function(a,h){c=t(h),c.data(i.NAMESPACE)&&(e=c.data(i.NAMESPACE),t.inArray(s[0],i.METHODS)>-1&&(n=s.shift(),e[n].apply(e,s)))}):this.each(function(e,n){c=t(n),c.data(i.NAMESPACE)||c.data(i.NAMESPACE,new a(c,s[0]))})}})(jQuery);